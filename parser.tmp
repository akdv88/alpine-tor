#!/bin/sh

http="http:\/\/.*"
https="https:\/\/.*"
pac="tor-proxy.pac"

(
  echo -e "Generated at $(date)\n\nfunction FindProxyForURL(url, host) {" > $pac

  curl http://api.antizapret.info/all.php \
| sed 's/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9];//g; s/^;//g; s/;.*$//g; s/^.*http:\/\//http:\/\//g; s/^.*https:\/\//https:\/\//g; /^$/d' \
| tr '[:upper:]' '[:lower:]' \
| while read line; do echo "$line" >> $pac; done
#echo " if (shExpMatch(url, \"$line\")) return \"SOCKS 192.168.1.155:9050\";"
  echo '        }'
) > /dev/null 2>&1

# shExpMatch must to be corrected
