#!/bin/sh

http="http:\/\/.*"
https="https:\/\/.*"
pac="tor-proxy.pac"
dir="/tmp"
list="/tmp/curl-list"

curl http://api.antizapret.info/all.php \
| sed 's/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9];//g; s/^;//g; s/;.*$//g; s/^.*http:\/\//http:\/\//g; s/^.*https:\/\//https:\/\//g; /^$/d' \
| tr '[:upper:]' '[:lower:]' > $list

# http
grep -E "^http:" $list > $dir/http \
        && sed -i '/^http:/d' $list \
        && sed -i 's/^http:\/\/www[0-9]*\./\*/g; s/^http:\/\//\*/g; s/\/.*//g; s/$/\*/g' $dir/http > $dir/out-list \
        && rm $dir/http

# https
grep -E "^https:" $list > $dir/https \
        && sed -i '/^https:/d' $list \
        && sed -i 's/^https:\/\/www[0-9]*\./\*/g; s/^https:\/\//\*/g; s/\/.*//g; s/$/\*/g' $dir/https >> $dir/out-list \
        && rm $dir/https

# asterisk
grep -E "^\*" $list > $dir/asterisk \
        && sed -i '/^\*/d' $list \
        && sed 's/^\*\./\*/g; s/$/\*/g' $dir/asterisk >> $dir/out-list \
        && rm $dir/asterisk

# comma
grep -E ',' $list > $dir/comma \
        && sed -i '/,/d' $list \
        && cat $dir/comma | tr "," "\n" | sed 's/^newcamd525:\/\//\*/g; s/:[0-9]*$/\*/g' >> $dir/out-list \
        && rm $dir/comma

# simple
mv $list $dir/simple \
        && sed 's/^www[0-9]*//g; s/^/\*/g; s/$/\*/g' $dir/simple >> $dir/out-list \
        && rm $dir/simple
